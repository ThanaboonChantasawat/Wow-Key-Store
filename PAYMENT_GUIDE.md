# üí≥ ‡∏Ñ‡∏π‡πà‡∏°‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô Stripe Payment System

## üìã ‡∏™‡∏≤‡∏£‡∏ö‡∏±‡∏ç
1. [‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö](#‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö)
2. [‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö](#‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö)
3. [Payment Flow](#payment-flow)
4. [API Endpoints](#api-endpoints)
5. [Components](#components)
6. [‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á](#‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á)

---

## üéØ ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏∞‡∏ö‡∏ö

‡∏£‡∏∞‡∏ö‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏ä‡πâ **Stripe Connect** ‡πÅ‡∏ö‡∏ö **Direct Charges** ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö Marketplace:

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á:
```
‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ‚Üí ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (Platform) ‚Üí ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Connected Account)
       üí≥ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô              ‚úÇÔ∏è ‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10%
```

### ‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:
- ‚úÖ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° (‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢)
- ‚úÖ ‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10% ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
- ‚úÖ ‡πÄ‡∏á‡∏¥‡∏ô‡πÇ‡∏≠‡∏ô‡∏ï‡∏£‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏ú‡πà‡∏≤‡∏ô Stripe)
- ‚úÖ ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Thailand (TH)

---

## üß™ ‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏£‡∏∞‡∏ö‡∏ö

### 1. ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (Seller)
1. ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Seller Dashboard > ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô**
2. ‡∏Ñ‡∏•‡∏¥‡∏Å **"‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Stripe"**
3. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏ô‡∏Ñ‡∏£‡∏ö (‡πÉ‡∏ô Test Mode ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á)
4. ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏à‡∏ô **Payouts Enabled = ‚úÖ**

### 2. ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
1. ‡πÄ‡∏Ç‡πâ‡∏≤‡πÑ‡∏õ‡∏ó‡∏µ‡πà `/payment/test`
2. ‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:
   - **Seller User ID**: UID ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏´‡∏≤‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Firestore)
   - **‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤**: ‡πÄ‡∏ä‡πà‡∏ô "Game Key - Valorant"
   - **‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏™‡∏ï‡∏≤‡∏á‡∏Ñ‡πå)**: ‡πÄ‡∏ä‡πà‡∏ô 10000 = ‡∏ø100
   - **‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏ã‡∏∑‡πâ‡∏≠**: ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
3. ‡∏Ñ‡∏•‡∏¥‡∏Å **"‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"**
4. ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö:

#### üî¢ ‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö Stripe
```
‚úÖ ‡∏ä‡∏≥‡∏£‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:
   ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç: 4242 4242 4242 4242
   MM/YY:    12/34 (‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ)
   CVC:      123 (3 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ)
   ZIP:      10110 (5 ‡∏´‡∏•‡∏±‡∏Å‡πÉ‡∏î‡∏Å‡πá‡πÑ‡∏î‡πâ)

‚ùå ‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò:
   ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç: 4000 0000 0000 0002

‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á 3D Secure:
   ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç: 4000 0025 0000 3155
```

5. ‡∏Ñ‡∏•‡∏¥‡∏Å **"‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô"**
6. ‡∏ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏à‡∏∞‡∏û‡∏≤‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Success ‚úÖ

### 3. ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

#### A) ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏≤:
- **Seller Dashboard > ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢**: ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢‡πÉ‡∏´‡∏°‡πà
- **Seller Dashboard > ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô**: ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô

#### B) ‡πÉ‡∏ô Stripe Dashboard:
1. ‡πÄ‡∏õ‡∏¥‡∏î https://dashboard.stripe.com/test
2. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Payments**: ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Payment
3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Connect > Accounts**: ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢
4. ‡∏Ñ‡∏•‡∏¥‡∏Å **View Dashboard**: ‡∏à‡∏∞‡πÄ‡∏´‡πá‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢

---

## üîÑ Payment Flow

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô:

```
1Ô∏è‚É£ ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
   ‚Üì
2Ô∏è‚É£ ‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏ã‡∏∑‡πâ‡∏≠‡πÄ‡∏•‡∏¢"
   ‚Üì
3Ô∏è‚É£ ‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏£‡πâ‡∏≤‡∏á Payment Intent
   - ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API: /api/stripe/create-payment-intent
   - ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: amount, sellerId, productName, etc.
   - ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10%
   ‚Üì
4Ô∏è‚É£ ‡πÅ‡∏™‡∏î‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (Payment Checkout)
   - ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£
   - Stripe ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ö‡∏±‡∏ï‡∏£
   ‚Üì
5Ô∏è‚É£ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
   - ‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏±‡∏ï‡∏£
   - Stripe ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢ (‡∏´‡∏±‡∏Å‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10%)
   - Platform ‡πÑ‡∏î‡πâ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10%
   ‚Üì
6Ô∏è‚É£ Redirect ‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Success
   - ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
   - ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô
```

### ‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏á‡∏¥‡∏ô:

```
‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:      ‡∏ø100.00
‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° 10%: ‡∏ø 10.00
‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:     ‡∏ø 90.00
```

---

## üõ†Ô∏è API Endpoints

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Payment Intent
```typescript
POST /api/stripe/create-payment-intent

Body:
{
  amount: number,              // in satang (10000 = ‡∏ø100)
  currency: string,            // "thb"
  sellerId: string,            // Seller User ID
  orderId: string,             // Order ID
  productName: string,         // Product name
  buyerEmail: string           // Buyer email
}

Response:
{
  success: true,
  clientSecret: string,        // ‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ Stripe Elements
  paymentIntentId: string,     // ‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÉ‡∏ô Order
  platformFee: number          // ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°
}
```

### 2. ‡∏î‡∏π‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Payment
```typescript
GET /api/stripe/payment-intent?paymentIntentId=pi_xxx

Response:
{
  success: true,
  paymentIntent: {
    id: string,
    amount: number,
    currency: string,
    status: string,            // "succeeded", "pending", etc.
    created: number,
    metadata: object
  }
}
```

### 3. ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Refund)
```typescript
POST /api/stripe/refund

Body:
{
  paymentIntentId: string,
  amount?: number,             // optional (full refund if omitted)
  reason?: string              // "requested_by_customer", etc.
}

Response:
{
  success: true,
  refundId: string,
  amount: number,
  status: string
}
```

### 4. ‡∏î‡∏π‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô (Balance)
```typescript
GET /api/stripe/balance

Response:
{
  available: [{ amount: number, currency: string }],
  pending: [{ amount: number, currency: string }],
  currency: string
}
```

### 5. ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≤‡∏¢ (Charges)
```typescript
GET /api/stripe/charges?limit=20

Response:
{
  charges: Array<{
    id: string,
    amount: number,
    currency: string,
    status: string,
    created: number,
    description: string,
    receipt_url: string,
    paid: boolean,
    refunded: boolean
  }>,
  has_more: boolean
}
```

### 6. ‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Payouts)
```typescript
GET /api/stripe/payouts

Response:
{
  payouts: Array<{
    id: string,
    amount: number,
    currency: string,
    status: string,
    arrival_date: number,
    created: number
  }>
}
```

---

## üé® Components

### 1. PaymentCheckout
```tsx
import PaymentCheckout from "@/components/payment/payment-checkout"

<PaymentCheckout
  amount={10000}                    // ‡∏ø100 in satang
  currency="thb"
  sellerId="user123"
  orderId="ORDER-001"
  productName="Game Key"
  buyerEmail="buyer@example.com"
  onSuccess={() => router.push('/payment/success')}
  onCancel={() => router.back()}
/>
```

### 2. SellerEarnings
```tsx
import SellerEarnings from "@/components/sellerdashboard/seller-earnings"

<SellerEarnings />
```
‡πÅ‡∏™‡∏î‡∏á:
- ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏≠‡∏ô / ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ / ‡∏£‡∏ß‡∏°
- ‡∏£‡∏≠‡∏ö‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ
- ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥: ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ / ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ô‡∏µ‡πâ / ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ

### 3. SellerSalesHistory
```tsx
import SellerSalesHistory from "@/components/sellerdashboard/seller-sales-history"

<SellerSalesHistory />
```
‡πÅ‡∏™‡∏î‡∏á:
- ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ò‡∏∏‡∏£‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à / ‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô / ‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£, ‡πÉ‡∏ö‡πÄ‡∏™‡∏£‡πá‡∏à

### 4. SellerPayouts
```tsx
import SellerPayouts from "@/components/sellerdashboard/seller-payouts"

<SellerPayouts />
```
‡πÅ‡∏™‡∏î‡∏á:
- ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô
- ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÇ‡∏≠‡∏ô, ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞

---

## üöÄ ‡∏Å‡∏≤‡∏£‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡∏à‡∏£‡∏¥‡∏á

### ‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á (Live Mode):

#### 1. ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Live Keys
‡πÉ‡∏ô `.env.local`:
```env
# ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏à‡∏≤‡∏Å test keys
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_live_xxxxx
STRIPE_SECRET_KEY=sk_live_xxxxx
```

#### 2. ‡πÄ‡∏õ‡∏¥‡∏î Live Mode ‡πÉ‡∏ô Stripe
1. ‡πÄ‡∏Ç‡πâ‡∏≤ https://dashboard.stripe.com
2. ‡∏™‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å "Test Mode" ‚Üí "Live Mode"
3. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà **Settings > Connect**
4. ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô Connect

#### 3. ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥ Onboarding ‡∏à‡∏£‡∏¥‡∏á
- ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (‡∏ä‡∏∑‡πà‡∏≠, ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà, ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£)
- Stripe ‡∏à‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (1-2 ‡∏ß‡∏±‡∏ô)
- ‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö ‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î Payouts

#### 4. ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏à‡∏£‡∏¥‡∏á
- ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï/‡πÄ‡∏î‡∏ö‡∏¥‡∏ï‡∏à‡∏£‡∏¥‡∏á
- ‡πÄ‡∏á‡∏¥‡∏ô‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏´‡∏±‡∏Å‡∏à‡∏£‡∏¥‡∏á
- Stripe ‡∏à‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏° (2.95% + ‡∏ø10/‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)

#### 5. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook (‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç!)
1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà Stripe Dashboard > **Developers > Webhooks**
2. Add endpoint: `https://yourdomain.com/api/stripe/webhook`
3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å events:
   - `payment_intent.succeeded`
   - `payment_intent.payment_failed`
   - `charge.refunded`
   - `account.updated`
   - `payout.paid`

#### 6. ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Order ‡πÉ‡∏ô Firestore
‡πÄ‡∏°‡∏∑‡πà‡∏≠ `payment_intent.succeeded`:
- ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Order ‡πÄ‡∏õ‡πá‡∏ô "paid"
- ‡∏™‡πà‡∏á Game Key ‡πÉ‡∏´‡πâ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
- ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô

---

## üìä ‡∏Ñ‡πà‡∏≤‡∏ò‡∏£‡∏£‡∏°‡πÄ‡∏ô‡∏µ‡∏¢‡∏°

### Stripe Fees (Thailand):
- **2.95% + ‡∏ø10** ‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ö‡∏±‡∏ï‡∏£‡πÑ‡∏ó‡∏¢)
- **3.95% + ‡∏ø10** ‡∏ï‡πà‡∏≠‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡∏ö‡∏±‡∏ï‡∏£‡∏ï‡πà‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®)

### Platform Fee (‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏£‡∏≤):
- **10%** ‡∏Ç‡∏≠‡∏á‡∏¢‡∏≠‡∏î‡∏Ç‡∏≤‡∏¢

### ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì:
```
‡∏£‡∏≤‡∏Ñ‡∏≤‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:             ‡∏ø100.00
Platform Fee (10%):     -‡∏ø 10.00
‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö:            ‡∏ø 90.00

Stripe Fee (2.95% + ‡∏ø10):
  - ‡∏ø100 √ó 2.95% =      -‡∏ø  2.95
  - Fixed Fee =         -‡∏ø 10.00
  - Total Stripe Fee =  -‡∏ø 12.95

‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:       ‡∏ø 77.05
Platform ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:    ‡∏ø 10.00
```

---

## üîê ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢

### Best Practices:
1. ‚úÖ ‡πÉ‡∏ä‡πâ HTTPS ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
2. ‚úÖ ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Webhook signatures
3. ‚úÖ Validate ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á Payment Intent
4. ‚úÖ ‡πÄ‡∏Å‡πá‡∏ö Payment Intent ID ‡πÉ‡∏ô Order
5. ‚úÖ ‡∏≠‡∏¢‡πà‡∏≤‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï (‡πÉ‡∏´‡πâ Stripe ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£)
6. ‚úÖ Log ‡∏ó‡∏∏‡∏Å transaction
7. ‚úÖ Monitor suspicious activities

---

## üêõ Troubleshooting

### ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢:

#### 1. "Seller has not connected Stripe account"
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏ú‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Stripe ‡∏Å‡πà‡∏≠‡∏ô

#### 2. "Seller's Stripe account is not fully set up"
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏£‡∏≠‡πÉ‡∏´‡πâ Payouts Enabled = true (10-30 ‡∏ô‡∏≤‡∏ó‡∏µ ‡πÉ‡∏ô Test Mode)

#### 3. "Payment failed - card declined"
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡πÉ‡∏ä‡πâ‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á (4242 4242 4242 4242)

#### 4. "Platform fee too high"
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö `calculatePlatformFee()` ‡πÉ‡∏ô `lib/payment-service.ts`

#### 5. ‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô Seller Dashboard
**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:** ‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä" ‡∏´‡∏£‡∏∑‡∏≠ F5

---

## üìö ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°

- [Stripe Connect Docs](https://stripe.com/docs/connect)
- [Payment Intents](https://stripe.com/docs/payments/payment-intents)
- [Testing Cards](https://stripe.com/docs/testing)
- [Webhooks](https://stripe.com/docs/webhooks)

---

## ‚úÖ Checklist ‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏à‡∏£‡∏¥‡∏á

- [ ] ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô Live Keys
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Payment Flow ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏Å‡∏£‡∏ì‡∏µ
- [ ] ‡∏ó‡∏≥ Error Handling ‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Email Notifications
- [ ] ‡∏ó‡∏î‡∏™‡∏≠‡∏ö Refund
- [ ] ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Rate Limiting
- [ ] ‡πÄ‡∏û‡∏¥‡πà‡∏° Logging
- [ ] ‡∏ó‡∏≥ Load Testing
- [ ] ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Customer Support

---

**üéâ ‡∏Ç‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏µ‡∏Å‡∏≥‡πÑ‡∏£!**
